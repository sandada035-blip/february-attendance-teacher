<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Attendance Pro (Mobile)</title>

  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Hanuman:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
</head>

<body>
  <!-- ✅ Desktop/PC block screen -->
  <div class="desktop-block" id="desktopBlock">
    <div class="desktop-card">
      <img src="logo.png" alt="Logo" class="desktop-logo" onerror="this.style.display='none'">
      <h2>Mobile Only</h2>
      <p>សូមបើកតាមទូរសព្ទដៃ (Mobile) ដើម្បីមើល Dashboard នេះ។</p>
      <div class="tips">
        <div class="tip"><i class="fa-solid fa-mobile-screen"></i> iPhone / Android</div>
        <div class="tip"><i class="fa-solid fa-wifi"></i> Browser: Chrome/Safari</div>
      </div>
    </div>
  </div>

  <!-- ✅ Mobile App -->
  <div class="app" id="app">
    <!-- Top App Bar (Facebook style) -->
    <header class="appbar">
      <div class="appbar-left">
        <div class="app-avatar">
          <img src="logo.png" alt="Logo" onerror="this.style.display='none'">
        </div>
        <div class="appbar-title">
          <div class="title">Attendance Pro</div>
          <div class="subtitle" id="subTitle">វត្តមានប្រចាំថ្ងៃ</div>
        </div>
      </div>

      <div class="appbar-right">
        <button class="icon-pill" onclick="openAdminLogin()" aria-label="Admin">
          <i class="fa-solid fa-user-shield"></i>
        </button>
        <button class="icon-pill" onclick="loadData(true)" aria-label="Refresh">
          <i class="fa-solid fa-rotate"></i>
        </button>
      </div>
    </header>

    <!-- Sticky controls (search + day select) -->
    <div class="controls">
      <div class="searchbox">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input id="searchInput" type="text" placeholder="ស្វែងរកឈ្មោះ..." autocomplete="off" oninput="searchCards()" />
        <button class="clear-btn" onclick="clearSearch()" aria-label="Clear"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div class="row">
        <select id="day-select" onchange="renderDaily()" aria-label="Select Day"></select>
        <span class="mode" id="admin-status">Mode: User</span>
      </div>
    </div>

    <!-- Pull-to-refresh hint -->
    <div class="pull-hint" id="pullHint">
      <div class="ph-dot"></div>
      <div class="ph-text" id="pullText">Pull down to refresh</div>
    </div>

    <!-- Main Feed -->
    <main class="feed" id="main-view"></main>

    <!-- Loader -->
    <div class="loader-bar hidden" id="loader">
      <div class="loader-spin"></div>
      <span>កំពុងទាញទិន្នន័យ...</span>
    </div>

    <!-- Error -->
    <div class="error hidden" id="error-panel">
      <div class="error-left">
        <i class="fa-solid fa-triangle-exclamation"></i>
        <div>
          <div class="e-title">មានបញ្ហា</div>
          <div class="e-text" id="error-text">សូមព្យាយាមម្ដងទៀត។</div>
        </div>
      </div>
      <button class="btn" onclick="loadData(true)"><i class="fa-solid fa-rotate-right"></i> Retry</button>
    </div>

    <!-- Empty -->
    <div class="empty hidden" id="empty-state">
      <i class="fa-solid fa-inbox"></i>
      <h3>មិនមានទិន្នន័យ</h3>
      <p>សូមចុច Refresh ដើម្បីទាញទិន្នន័យឡើងវិញ។</p>
      <button class="btn primary" onclick="loadData(true)"><i class="fa-solid fa-rotate"></i> Refresh</button>
    </div>

    <!-- Bottom Tabs (FB style) -->
    <nav class="tabs">
      <button class="tab active" data-tab="daily" onclick="showTab('daily')">
        <i class="fa-solid fa-calendar-day"></i>
        <span>Daily</span>
      </button>
      <button class="tab" data-tab="summary" onclick="showTab('summary')">
        <i class="fa-solid fa-chart-simple"></i>
        <span>Summary</span>
      </button>
      <button class="tab" onclick="scrollToTop()">
        <i class="fa-solid fa-arrow-up"></i>
        <span>Top</span>
      </button>
    </nav>

    <!-- Admin Modal -->
    <div class="modal hidden" id="admin-modal" role="dialog" aria-modal="true">
      <div class="backdrop" onclick="closeAdminLogin()"></div>
      <div class="modal-card">
        <div class="modal-head">
          <div class="m-title"><i class="fa-solid fa-user-shield"></i> Admin Login</div>
          <button class="icon-pill" onclick="closeAdminLogin()"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body">
          <label>Password</label>
          <div class="passbox">
            <i class="fa-solid fa-key"></i>
            <input id="admin-pass" type="password" placeholder="បញ្ចូលលេខសម្ងាត់..." autocomplete="current-password">
          </div>
          <div class="hint">* Admin អាចកែទិន្នន័យ និង Save ទៅ Google Sheets</div>

          <div class="modal-actions">
            <button class="btn" onclick="closeAdminLogin()">Cancel</button>
            <button class="btn primary" onclick="loginAdmin()"><i class="fa-solid fa-right-to-bracket"></i> Login</button>
          </div>

          <div class="m-error hidden" id="admin-login-error"></div>

          <div class="logout-row hidden" id="logoutRow">
            <button class="btn danger" onclick="logoutAdmin()"><i class="fa-solid fa-right-from-bracket"></i> Logout Admin</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast hidden" id="toast">
      <i class="fa-solid fa-circle-check"></i>
      <span id="toast-text">Done</span>
    </div>
  </div>

  <script>
    // ✅ Mobile-only gate (simple)
    function isMobileUA() {
      const w = Math.min(window.innerWidth, window.innerHeight);
      return w <= 900; // allow tablets/phones
    }
    const desktopBlock = document.getElementById("desktopBlock");
    const app = document.getElementById("app");
    const mobileOk = isMobileUA();
    desktopBlock.style.display = mobileOk ? "none" : "flex";
    app.style.display = mobileOk ? "block" : "none";
  </script>

  <script src="script.js"></script>
</body>
</html>
